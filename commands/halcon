#!/bin/bash
# HALCON - Cosmic Productivity Command Center
# Main command router for all HALCON astrological tools

# Resolve symlinks to get the actual script location
SOURCE="${BASH_SOURCE[0]}"
while [ -L "$SOURCE" ]; do
  DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

# Colors
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
MAGENTA='\033[0;35m'
NC='\033[0m'

show_banner() {
    echo -e "${CYAN}"
    echo "╔═══════════════════════════════════════════════════════════════╗"
    echo "║                                                               ║"
    echo "║    ██╗  ██╗ █████╗ ██╗      ██████╗ ██████╗ ███╗   ██╗      ║"
    echo "║    ██║  ██║██╔══██╗██║     ██╔════╝██╔═══██╗████╗  ██║      ║"
    echo "║    ███████║███████║██║     ██║     ██║   ██║██╔██╗ ██║      ║"
    echo "║    ██╔══██║██╔══██║██║     ██║     ██║   ██║██║╚██╗██║      ║"
    echo "║    ██║  ██║██║  ██║███████╗╚██████╗╚██████╔╝██║ ╚████║      ║"
    echo "║    ╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝ ╚═════╝ ╚═════╝ ╚═╝  ╚═══╝      ║"
    echo "║                                                               ║"
    echo "║         Cosmic Productivity & Astrological Insights          ║"
    echo "║                                                               ║"
    echo "╚═══════════════════════════════════════════════════════════════╝"
    echo -e "${NC}"
}

show_help() {
    show_banner
    echo ""
    echo -e "${GREEN}Available Commands:${NC}"
    echo ""
    echo -e "  ${CYAN}transits${NC}       Show current planetary positions"
    echo -e "  ${CYAN}chart${NC}          Generate natal birth chart"
    echo -e "  ${CYAN}progressions${NC}   Calculate secondary progressions"
    echo -e "  ${CYAN}aspects${NC}        Show planetary aspects (current or for profile)"
    echo -e "  ${CYAN}houses${NC}         Calculate house cusps for birth chart"
    echo -e "  ${CYAN}analysis${NC}       Generate AI-powered astrological snapshot"
    echo ""
    echo -e "${GREEN}Usage Examples:${NC}"
    echo -e "  ${YELLOW}Current transits:${NC}"
    echo "    halcon transits"
    echo ""
    echo -e "  ${YELLOW}Chart from profile:${NC}"
    echo "    halcon chart manu"
    echo "    halcon chart manu --houses placidus"
    echo ""
    echo -e "  ${YELLOW}Chart from natural language:${NC}"
    echo "    halcon chart mar 10 1990, kurnool india, 12:55 PM"
    echo ""
    echo -e "  ${YELLOW}Chart with coordinates:${NC}"
    echo "    halcon chart --date 1990-01-15 --time 14:30:00 --lat 40.7 --lon -74"
    echo ""
    echo -e "  ${YELLOW}Progressions for profile:${NC}"
    echo "    halcon progressions manu"
    echo "    halcon progressions manu --to 2025-12-31"
    echo ""
    echo -e "  ${YELLOW}Aspects for profile:${NC}"
    echo "    halcon aspects manu"
    echo "    halcon aspects manu --orb 8"
    echo ""
    echo -e "  ${YELLOW}Aspects for current date:${NC}"
    echo "    halcon aspects --date 2025-10-15"
    echo ""
    echo -e "  ${YELLOW}Houses for profile:${NC}"
    echo "    halcon houses manu --system placidus"
    echo "    halcon houses manu --system whole-sign"
    echo ""
    echo -e "  ${YELLOW}AI-powered analysis:${NC}"
    echo "    halcon analysis manu"
    echo "    halcon analysis manu --type career"
    echo "    halcon analysis manu --data-only"
    echo ""
    echo -e "${GREEN}Get Help:${NC}"
    echo "  halcon <command> --help    Show detailed help for a command"
    echo ""
    echo -e "${MAGENTA}✨ Powered by ephemeris.fyi + Swiss Ephemeris${NC}"
    echo ""
}

# Main command router
COMMAND=$1
shift

case "$COMMAND" in
    transits)
        exec "$SCRIPT_DIR/transits" "$@"
        ;;
    chart)
        exec "$SCRIPT_DIR/chart" "$@"
        ;;
    progressions)
        exec "$SCRIPT_DIR/progressions" "$@"
        ;;
    aspects)
        exec "$SCRIPT_DIR/aspects" "$@"
        ;;
    houses)
        exec "$SCRIPT_DIR/houses" "$@"
        ;;
    analysis)
        exec "$SCRIPT_DIR/analysis" "$@"
        ;;
    help|--help|-h|"")
        show_help
        ;;
    *)
        echo -e "${YELLOW}Unknown command: $COMMAND${NC}"
        echo ""
        show_help
        exit 1
        ;;
esac